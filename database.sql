CREATE TABLE CUSTOMER(
SSN INT PRIMARY KEY,
FNAME VARCHAR(50),
LNAME VARCHAR(50),
DOB DATE,
GENDER VARCHAR(1),
ADDRESS VARCHAR(50),
PHONE_NO int
);

INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('111', 'Krishna', 'Rana', '01-01-1990', 'M', 'Mandvi', '1234567890');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('222', 'Alis', 'Desai', '15-05-1995', 'M', 'Surat', '1234587690');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('333', 'Kashish', 'Jingar', '20-11-1988', 'F', 'Vadodara', '1255495156');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('444', 'Saumil', 'Prajapati', '04-10-1987', 'M', 'Palanpur', '1456015644');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('555', 'Meet', 'Dobariya', '25-09-1992', 'M', 'Surat', '1678912354');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('666', 'Akshay', 'Shiyani', '28-02-1998', 'M', 'Porbandar', '1789701245');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('777', 'Mirali', 'Lakhani', '07-08-1991', 'F', 'Porbandar', '1890192356');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('888', 'Ravi', 'Jethva', '30-12-1985', 'M', 'Somnath', '1901234647');
INSERT INTO CUSTOMER (SSN, FNAME, LNAME, DOB, GENDER, ADDRESS, PHONE_NO) VALUES
('999', 'Soham', 'Shukla', '03-05-1993', 'M', 'Daheli', '1012374678');

CREATE TABLE EMPLOYEE(
EMP_ID INT PRIMARY KEY,
SSN INT,
FNAME VARCHAR(50),
LNAME VARCHAR(50),
SALARY INT,
DOB DATE,
PHONE_NO INT,
LICENCE INT,
FOREIGN KEY (SSN) REFERENCES CUSTOMER (SSN)
);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(101, 111, 'Aarav', 'Patel', 50000, '05-01-1990', '1234567890', 123456);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(102, 222, 'Diya', 'Sharma', 55000, '15-09-1988', '1245644901', 123457);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(103, 333, 'Ishaan', 'Singh', 60000, '20-02-1992', '1546789012', 123458);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(104, 444, 'Neha', 'Kumar', 52000, '07-10-1995', '1467890123', 123459);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(105, 555, 'Aisha', 'Gupta', 48000, '25-12-1985', '1678901234', 123460);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(106, 666, 'Rohan', 'Verma', 58000, '30-04-1987', '1789012345', 123461);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(107, 777, 'Anaya', 'Joshi', 62000, '10-05-1993', '1890123456', 123462);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(108, 888, 'Kabir', 'Malhotra', 54000, '15-03-1998', '1901234567', 123463);
INSERT INTO EMPLOYEE (EMP_ID, SSN, FNAME, LNAME, SALARY, DOB, PHONE_NO, LICENCE) VALUES
(109, 999, 'Avani', 'Dixit', 57000, '20-08-1991', '1012345678', 123464);


CREATE TABLE ORDERS(
ORDER_ID INT PRIMARY KEY,
EMP_ID INT,
ORDER_DATE DATE,
FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE (EMP_ID)
);

INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(1, 101, '19-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(2, 102, '18-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(3, 103, '17-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(4, 104, '16-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(5, 105, '15-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(6, 106, '14-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(7, 107, '13-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(8, 108, '12-03-2024');
INSERT INTO ORDERS (ORDER_ID, EMP_ID, ORDER_DATE) VALUES
(9, 109, '11-03-2024');

CREATE TABLE MEDICINE(
MED_ID INT PRIMARY KEY,
DRUG_NAME VARCHAR(50),
MEDI_TYPE VARCHAR(50),
BATCH_NO INT,
PRICE INT,
STOCK_QTY INT,
EXPIRY_DATE DATE
);

INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(1, 'Paracetamol', 'Tablet', 123456, 50, 100, '31-12-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(2, 'Aspirin', 'Tablet', 234567, 60, 120, '30-06-2025');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(3, 'Amoxicillin', 'Capsule', 345678, 80, 80, '30-09-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(4, 'Omeprazole', 'Capsule', 456789, 70, 90, '31-10-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(5, 'Azithromycin', 'Tablet', 567890, 90, 70, '31-03-2025');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(6, 'Metformin', 'Tablet', 678901, 65, 110, '31-08-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(7, 'Atorvastatin', 'Tablet', 789012, 75, 100, '30-04-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(8, 'Diclofenac', 'Tablet', 890123, 55, 80, '31-12-2024');
INSERT INTO MEDICINE (MED_ID, DRUG_NAME, MEDI_TYPE, BATCH_NO, PRICE, STOCK_QTY, EXPIRY_DATE) VALUES
(9, 'Ibuprofen', 'Tablet', 901234, 45, 150, '28-02-2025');

CREATE TABLE MEDICINE_TYPE(
MED_ID INT,
MEDI_TYPE VARCHAR(50),
FOREIGN KEY (MED_ID) REFERENCES MEDICINE (MED_ID)
);

INSERT INTO MEDICINE_TYPE (MED_ID, MEDI_TYPE)
SELECT MED_ID, MEDI_TYPE FROM MEDICINE;

CREATE TABLE ORDER_DETAIL (
    ORDER_ID INT,
    MED_ID INT,
    PRICE INT,
    ORDERED_QTY INT,
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ORDER_ID),
    FOREIGN KEY (MED_ID) REFERENCES MEDICINE (MED_ID)
);

INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(1,1,500,10);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(2, 2,240,4);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(3, 3,400,5);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(4, 4,700,10);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(5, 5,450,5);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(6, 6,65,1);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(7, 7,150,2);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(8, 8,220,4);
INSERT INTO ORDER_DETAIL (ORDER_ID, MED_ID, PRICE, ORDERED_QTY) VALUES
(9, 9,270,6);

Create table disposal (
MED_ID INT,
DRUG_NAME VARCHAR(50),
QUANTITY INT,
FOREIGN KEY (MED_ID) REFERENCES MEDICINE (MED_ID));
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(1, 'Paracetamol',37);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(2, 'Aspirin',15);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(3, 'Amoxicillin', 45);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(4, 'Omeprazole', 55);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(5, 'Azithromycin', 67);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(6, 'Metformin', 23);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(7, 'Atorvastatin', 39);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(8, 'Diclofenac', 56);
Insert into disposal (MED_ID, DRUG_NAME, QUANTITY) values 
(9, 'Ibuprofen', 77);
TRIGGER
//NOT 
CREATE OR REPLACE TRIGGER check_expiry
BEFORE INSERT ON ORDER_DETAIL
FOR EACH ROW
DECLARE
    v_expiry_date DATE;
BEGIN
    SELECT EXPIRY_DATE INTO v_expiry_date
    FROM MEDICINE
    WHERE MED_ID = :NEW.MED_ID;

    IF v_expiry_date < SYSDATE THEN
        RAISE_APPLICATION_ERROR(-20001, 'Selected medicine is expired!');
    END IF;
END;
/


CREATE OR REPLACE TRIGGER update_stock_quantity
AFTER INSERT ON ORDER_DETAIL
FOR EACH ROW
BEGIN
    UPDATE MEDICINE
    SET STOCK_QTY = STOCK_QTY - :NEW.ORDERED_QTY
    WHERE MED_ID = :NEW.MED_ID;
END;
/
